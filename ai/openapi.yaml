openapi: 3.0.0
info:
  title: Musashi AI Agent API
  description: |
    Musashi provides AI-powered sentiment analysis and prediction market signals via Chrome Extension messaging.

    **Base Protocol**: Chrome Extension Messaging (not REST HTTP)

    **Communication Method**:
    ```javascript
    chrome.runtime.sendMessage(extensionId, message, callback)
    ```

    **Security**: Only accepts connections from localhost/127.0.0.1
  version: 1.0.0
  contact:
    name: Musashi Support
    url: https://musashi.bot
  license:
    name: MIT

servers:
  - url: chrome-extension://YOUR_EXTENSION_ID
    description: Musashi Chrome Extension

tags:
  - name: News
    description: Sentiment analysis for trending news
  - name: Markets
    description: Prediction market data and signals
  - name: Health
    description: Extension health and status

paths:
  /api/news-analyses:
    get:
      summary: Get News Analyses
      description: Retrieve AI-powered sentiment analysis for trending news stories
      operationId: getNewsAnalyses
      tags:
        - News
      x-chrome-message-type: API_GET_NEWS_ANALYSES
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/NewsAnalysis'
        '500':
          description: Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/market-signals:
    get:
      summary: Get Market Signals
      description: Retrieve sentiment signals for prediction markets
      operationId: getMarketSignals
      tags:
        - Markets
      x-chrome-message-type: API_GET_MARKET_SIGNALS
      parameters:
        - name: marketId
          in: query
          description: Optional market ID to filter results
          required: false
          schema:
            type: string
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/MarketSignal'
        '500':
          description: Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/markets:
    get:
      summary: Get All Markets
      description: Retrieve complete market database (500+ markets)
      operationId: getAllMarkets
      tags:
        - Markets
      x-chrome-message-type: API_GET_MARKETS
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Market'
        '500':
          description: Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/health:
    get:
      summary: Health Check
      description: Verify Musashi extension is running and responsive
      operationId: healthCheck
      tags:
        - Health
      x-chrome-message-type: API_HEALTH
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/HealthData'
        '500':
          description: Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

components:
  schemas:
    NewsAnalysis:
      type: object
      required:
        - title
        - timestamp
        - tweetCount
        - overallSentiment
        - relatedMarkets
        - sentimentTrend
      properties:
        title:
          type: string
          description: News headline
          example: "Breaking: Major Political Development"
        timestamp:
          type: integer
          format: int64
          description: Unix timestamp in milliseconds
          example: 1708876800000
        tweetCount:
          type: integer
          description: Number of tweets analyzed
          example: 47
        overallSentiment:
          type: object
          required:
            - sentiment
            - confidence
            - reasoning
            - keyPoints
          properties:
            sentiment:
              $ref: '#/components/schemas/Sentiment'
            confidence:
              type: number
              format: float
              minimum: 0
              maximum: 1
              description: Confidence score from 0.0 to 1.0
              example: 0.87
            reasoning:
              type: string
              description: AI-generated explanation
              example: "Strong positive indicators from multiple reliable sources..."
            keyPoints:
              type: array
              items:
                type: string
              description: Bullet points of key insights
              example:
                - "Market momentum increasing"
                - "High trading volume detected"
        relatedMarkets:
          type: array
          items:
            $ref: '#/components/schemas/MarketSignal'
        sentimentTrend:
          type: array
          items:
            $ref: '#/components/schemas/SentimentPoint'

    MarketSignal:
      type: object
      required:
        - market
        - sentiment
        - confidence
        - reasoning
        - currentPrice
        - suggestedAction
        - actionConfidence
      properties:
        market:
          $ref: '#/components/schemas/Market'
        sentiment:
          $ref: '#/components/schemas/Sentiment'
        confidence:
          type: number
          format: float
          minimum: 0
          maximum: 1
          description: Sentiment confidence score
          example: 0.82
        reasoning:
          type: string
          description: AI explanation for the signal
          example: "Recent news cycle shows strong positive momentum..."
        currentPrice:
          type: number
          format: float
          minimum: 0
          maximum: 1
          description: Current YES price (0.0 to 1.0)
          example: 0.45
        suggestedAction:
          $ref: '#/components/schemas/SuggestedAction'
        actionConfidence:
          type: number
          format: float
          minimum: 0
          maximum: 1
          description: Action confidence score
          example: 0.78

    Market:
      type: object
      required:
        - id
        - title
        - platform
        - category
        - yesPrice
        - noPrice
        - volume
        - endDate
        - url
      properties:
        id:
          type: string
          description: Unique market identifier
          example: "market-123"
        title:
          type: string
          description: Market question
          example: "Will Bitcoin reach $100k in 2025?"
        platform:
          type: string
          enum:
            - polymarket
            - kalshi
          description: Prediction market platform
          example: "polymarket"
        category:
          type: string
          description: Market category
          example: "crypto"
        yesPrice:
          type: number
          format: float
          minimum: 0
          maximum: 1
          description: Current YES price
          example: 0.45
        noPrice:
          type: number
          format: float
          minimum: 0
          maximum: 1
          description: Current NO price
          example: 0.55
        volume:
          type: number
          format: float
          description: Total trading volume in USD
          example: 1250000
        liquidity:
          type: number
          format: float
          description: Available liquidity in USD
          example: 500000
        endDate:
          type: string
          format: date-time
          description: Market resolution date
          example: "2025-12-31T23:59:59Z"
        url:
          type: string
          format: uri
          description: Market URL
          example: "https://polymarket.com/event/..."

    SentimentPoint:
      type: object
      required:
        - timestamp
        - sentiment
        - confidence
      properties:
        timestamp:
          type: integer
          format: int64
          description: Unix timestamp in milliseconds
          example: 1708876800000
        sentiment:
          $ref: '#/components/schemas/Sentiment'
        confidence:
          type: number
          format: float
          minimum: 0
          maximum: 1
          example: 0.87

    HealthData:
      type: object
      required:
        - status
        - version
        - marketsLoaded
        - lastUpdate
      properties:
        status:
          type: string
          enum:
            - healthy
          example: "healthy"
        version:
          type: string
          description: Extension version
          example: "1.0.0"
        marketsLoaded:
          type: integer
          description: Number of markets in database
          example: 700
        lastUpdate:
          type: integer
          format: int64
          description: Last update timestamp
          example: 1708876800000

    Sentiment:
      type: string
      enum:
        - bullish
        - bearish
        - neutral
      description: |
        Sentiment type:
        - `bullish`: Positive outlook, price likely to increase
        - `bearish`: Negative outlook, price likely to decrease
        - `neutral`: No clear direction
      example: "bullish"

    SuggestedAction:
      type: string
      enum:
        - buy
        - sell
        - hold
      description: |
        Trading action:
        - `buy`: Purchase YES shares (bullish signal)
        - `sell`: Purchase NO shares (bearish signal)
        - `hold`: Wait for clearer signal
      example: "buy"

    Error:
      type: object
      required:
        - success
        - error
      properties:
        success:
          type: boolean
          example: false
        error:
          type: string
          description: Error message
          example: "Extension not responding"

  examples:
    NewsAnalysisExample:
      value:
        success: true
        data:
          - title: "Breaking: Major Tech Announcement"
            timestamp: 1708876800000
            tweetCount: 142
            overallSentiment:
              sentiment: "bullish"
              confidence: 0.89
              reasoning: "Strong positive indicators from multiple reliable sources with high engagement"
              keyPoints:
                - "Market momentum increasing significantly"
                - "High trading volume detected across platforms"
                - "Expert consensus aligns with positive outlook"
            relatedMarkets:
              - market:
                  id: "market-456"
                  title: "Will AI regulation pass by 2025?"
                  platform: "polymarket"
                  category: "technology"
                  yesPrice: 0.67
                  noPrice: 0.33
                  volume: 2500000
                  endDate: "2025-12-31T23:59:59Z"
                  url: "https://polymarket.com/event/ai-regulation"
                sentiment: "bullish"
                confidence: 0.85
                reasoning: "News directly supports YES outcome with high confidence"
                currentPrice: 0.67
                suggestedAction: "buy"
                actionConfidence: 0.82
            sentimentTrend:
              - timestamp: 1708876200000
                sentiment: "neutral"
                confidence: 0.51
              - timestamp: 1708876500000
                sentiment: "bullish"
                confidence: 0.72
              - timestamp: 1708876800000
                sentiment: "bullish"
                confidence: 0.89

x-chrome-messaging:
  description: |
    This API uses Chrome Extension Messaging instead of HTTP.

    **Send Message:**
    ```javascript
    chrome.runtime.sendMessage(
      extensionId,
      {
        type: 'API_GET_NEWS_ANALYSES',
        data: {}
      },
      (response) => {
        console.log(response);
      }
    );
    ```

    **Message Types:**
    - `API_GET_NEWS_ANALYSES` - Get news analyses
    - `API_GET_MARKET_SIGNALS` - Get market signals
    - `API_GET_MARKETS` - Get all markets
    - `API_HEALTH` - Health check

    **Response Format:**
    ```json
    {
      "success": true,
      "data": { ... }
    }
    ```

    **Error Format:**
    ```json
    {
      "success": false,
      "error": "Error message"
    }
    ```
